<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Functionality Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-2xl mx-auto">
        <h1 class="text-3xl font-bold mb-8 text-center">Search Functionality Test</h1>
        
        <!-- Client Search Test -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-xl font-bold mb-4">Client Search Test</h2>
            <div class="relative">
                <input type="text" 
                       id="client-search" 
                       placeholder="Search clients by name or ID..." 
                       class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                    <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                    </svg>
                </div>
            </div>
            
            <div id="client-search-results" class="hidden mt-2 max-h-60 overflow-y-auto border border-gray-200 rounded-lg bg-white shadow-lg">
                <div id="client-results-list" class="max-h-60 overflow-y-auto"></div>
                <div id="client-no-results" class="hidden p-4 text-center text-gray-500">
                    <p class="text-sm">No clients found</p>
                </div>
            </div>
        </div>
        
        <!-- Program Search Test -->
        <div class="bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-xl font-bold mb-4">Program Search Test</h2>
            <div class="relative">
                <input type="text" 
                       id="program-search" 
                       placeholder="Search programs by name, department, or location..." 
                       class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                    <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                    </svg>
                </div>
            </div>
            
            <div id="program-search-results" class="hidden mt-2 max-h-60 overflow-y-auto border border-gray-200 rounded-lg bg-white shadow-lg">
                <div id="program-results-list" class="max-h-60 overflow-y-auto"></div>
                <div id="program-no-results" class="hidden p-4 text-center text-gray-500">
                    <p class="text-sm">No programs found</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Utility function to highlight search terms
        function highlightSearchTerm(text, searchTerm) {
            if (!searchTerm || !text) return text;
            
            const regex = new RegExp(`(${searchTerm.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
            return text.replace(regex, '<span class="bg-yellow-200 font-bold text-yellow-800 px-1 rounded">$1</span>');
        }

        // Client Search Functionality
        function initializeClientSearch() {
            const clientSearchInput = document.getElementById('client-search');
            const clientSearchResults = document.getElementById('client-search-results');
            const clientResultsList = document.getElementById('client-results-list');
            const clientNoResults = document.getElementById('client-no-results');
            
            let searchTimeout;
            
            // Client search input event
            clientSearchInput.addEventListener('input', function() {
                clearTimeout(searchTimeout);
                const searchTerm = this.value.trim();
                
                if (searchTerm.length === 0) {
                    // Show all clients when input is empty
                    searchClients('');
                    return;
                }
                
                if (searchTerm.length < 2) {
                    hideClientResults();
                    return;
                }
                
                searchTimeout = setTimeout(() => {
                    searchClients(searchTerm);
                }, 300);
            });
            
            // Show results when input is focused
            clientSearchInput.addEventListener('focus', function() {
                if (this.value.trim().length === 0) {
                    searchClients('');
                }
            });
            
            function searchClients(term) {
                fetch(`/core/search-clients/?q=${encodeURIComponent(term)}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            displayClientResults(data.clients);
                        } else {
                            showClientNoResults();
                        }
                    })
                    .catch(error => {
                        console.error('Error searching clients:', error);
                        showClientNoResults();
                    });
            }
            
            function displayClientResults(clients) {
                if (clients.length === 0) {
                    showClientNoResults();
                    return;
                }
                
                clientResultsList.innerHTML = '';
                clients.forEach(client => {
                    const clientItem = document.createElement('div');
                    clientItem.className = 'search-result-item p-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0';
                    clientItem.innerHTML = `
                        <div class="font-bold text-gray-900">${highlightSearchTerm(client.name, clientSearchInput.value)}</div>
                        <div class="text-sm text-gray-500">ID: ${client.external_id}</div>
                    `;
                    clientItem.addEventListener('click', () => {
                        alert(`Selected: ${client.name}`);
                        clientSearchInput.value = client.name;
                        hideClientResults();
                    });
                    clientResultsList.appendChild(clientItem);
                });
                
                showClientResults();
            }
            
            function showClientResults() {
                clientSearchResults.classList.remove('hidden');
                clientNoResults.classList.add('hidden');
            }
            
            function showClientNoResults() {
                clientSearchResults.classList.remove('hidden');
                clientNoResults.classList.remove('hidden');
            }
            
            function hideClientResults() {
                clientSearchResults.classList.add('hidden');
            }
        }

        // Program Search Functionality
        function initializeProgramSearch() {
            const programSearchInput = document.getElementById('program-search');
            const programSearchResults = document.getElementById('program-search-results');
            const programResultsList = document.getElementById('program-results-list');
            const programNoResults = document.getElementById('program-no-results');
            
            let searchTimeout;
            
            // Program search input event
            programSearchInput.addEventListener('input', function() {
                clearTimeout(searchTimeout);
                const searchTerm = this.value.trim();
                
                if (searchTerm.length === 0) {
                    // Show all programs when input is empty
                    searchPrograms('');
                    return;
                }
                
                if (searchTerm.length < 2) {
                    hideProgramResults();
                    return;
                }
                
                searchTimeout = setTimeout(() => {
                    searchPrograms(searchTerm);
                }, 300);
            });
            
            // Show results when input is focused
            programSearchInput.addEventListener('focus', function() {
                if (this.value.trim().length === 0) {
                    searchPrograms('');
                }
            });
            
            function searchPrograms(term) {
                fetch(`/core/search-programs/?q=${encodeURIComponent(term)}`)
                    .then(response => response.json())
                    .then(data => {
                        displayProgramResults(data.programs);
                    })
                    .catch(error => {
                        console.error('Error searching programs:', error);
                        showProgramNoResults();
                    });
            }
            
            function displayProgramResults(programs) {
                if (programs.length === 0) {
                    showProgramNoResults();
                    return;
                }
                
                programResultsList.innerHTML = '';
                programs.forEach(program => {
                    const programItem = document.createElement('div');
                    programItem.className = 'search-result-item p-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0';
                    programItem.innerHTML = `
                        <div class="font-bold text-gray-900">${highlightSearchTerm(program.name, programSearchInput.value)}</div>
                        <div class="text-sm text-gray-500">${highlightSearchTerm(program.department, programSearchInput.value)} - ${highlightSearchTerm(program.location, programSearchInput.value)}</div>
                        <div class="text-xs text-gray-400 mt-1">Capacity: ${program.capacity}</div>
                    `;
                    programItem.addEventListener('click', () => {
                        alert(`Selected: ${program.name}`);
                        programSearchInput.value = program.name;
                        hideProgramResults();
                    });
                    programResultsList.appendChild(programItem);
                });
                
                showProgramResults();
            }
            
            function showProgramResults() {
                programSearchResults.classList.remove('hidden');
                programNoResults.classList.add('hidden');
            }
            
            function showProgramNoResults() {
                programSearchResults.classList.remove('hidden');
                programNoResults.classList.remove('hidden');
            }
            
            function hideProgramResults() {
                programSearchResults.classList.add('hidden');
            }
        }

        // Initialize search functionality when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeClientSearch();
            initializeProgramSearch();
        });
    </script>
</body>
</html>
