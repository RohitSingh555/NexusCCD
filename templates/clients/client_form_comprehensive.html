{% extends 'dashboard_base.html' %}
{% load static %}

{% block title %}{% if object %}Edit Client{% else %}Add New Client{% endif %} - Central Client Database{% endblock %}

{% block page_title %}{% if object %}Edit Client{% else %}Add New Client{% endif %}{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Header -->
    <div class="mb-8">
        <div class="flex items-center justify-between">
            <div>
                <h1 class="text-3xl font-bold text-neutral-800 font-header">
                    {% if object %}Edit Client{% else %}Add New Client{% endif %}
                </h1>
                <p class="text-neutral-600 mt-2 font-body">
                    {% if object %}Update comprehensive client information{% else %}Enter comprehensive client information{% endif %}
                </p>
            </div>
            <a href="{% url 'clients:list' %}" class="inline-flex items-center px-4 py-2 border border-neutral-300 text-sm font-bold rounded-xl text-neutral-700 bg-white hover:bg-neutral-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-sky transition-all duration-200 shadow-sm">
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                </svg>
                Back to Clients
            </a>
        </div>
    </div>

    <!-- Form -->
    <form method="post" enctype="multipart/form-data" class="space-y-8" x-data="clientForm()">
        {% csrf_token %}
        
        <!-- üßç CLIENT PERSONAL DETAILS -->
        <div class="bg-white rounded-xl shadow-sm border border-neutral-200 p-6">
            <div class="flex items-center mb-6">
                <div class="w-10 h-10 bg-gradient-to-br from-brand-sky to-brand-darkBlue rounded-lg flex items-center justify-center shadow-sm mr-4">
                    <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg>
                </div>
                <h2 class="text-xl font-bold text-neutral-800 font-header">üßç Client Personal Details</h2>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Client ID -->
                <div>
                    <label for="{{ form.client_id.id_for_label }}" class="block text-sm font-bold text-neutral-700 mb-2 font-subheader">Client ID</label>
                    <input type="text" name="{{ form.client_id.name }}" id="{{ form.client_id.id_for_label }}" value="{{ form.client_id.value|default:'' }}" class="form-control">
                    {% if form.client_id.errors %}
                        <div class="mt-1 text-sm text-red-600">{{ form.client_id.errors.0 }}</div>
                    {% endif %}
                </div>

                <!-- Last Name -->
                <div>
                    <label for="{{ form.last_name.id_for_label }}" class="block text-sm font-bold text-neutral-700 mb-2 font-subheader">Last Name *</label>
                    <input type="text" name="{{ form.last_name.name }}" id="{{ form.last_name.id_for_label }}" value="{{ form.last_name.value|default:'' }}" required class="form-control">
                    {% if form.last_name.errors %}
                        <div class="mt-1 text-sm text-red-600">{{ form.last_name.errors.0 }}</div>
                    {% endif %}
                </div>

                <!-- First Name -->
                <div>
                    <label for="{{ form.first_name.id_for_label }}" class="block text-sm font-bold text-neutral-700 mb-2 font-subheader">First Name *</label>
                    <input type="text" name="{{ form.first_name.name }}" id="{{ form.first_name.id_for_label }}" value="{{ form.first_name.value|default:'' }}" required class="form-control">
                    {% if form.first_name.errors %}
                        <div class="mt-1 text-sm text-red-600">{{ form.first_name.errors.0 }}</div>
                    {% endif %}
                </div>

                <!-- Middle Name -->
                <div>
                    <label for="{{ form.middle_name.id_for_label }}" class="block text-sm font-bold text-neutral-700 mb-2 font-subheader">Middle Name</label>
                    {{ form.middle_name }}
                    {% if form.middle_name.errors %}
                        <div class="mt-1 text-sm text-red-600">{{ form.middle_name.errors.0 }}</div>
                    {% endif %}
                </div>

                <!-- Preferred Name -->
                <div>
                    <label for="{{ form.preferred_name.id_for_label }}" class="block text-sm font-bold text-neutral-700 mb-2 font-subheader">Preferred Name</label>
                    {{ form.preferred_name }}
                    {% if form.preferred_name.errors %}
                        <div class="mt-1 text-sm text-red-600">{{ form.preferred_name.errors.0 }}</div>
                    {% endif %}
                </div>

                <!-- Alias -->
                <div>
                    <label for="{{ form.alias.id_for_label }}" class="block text-sm font-bold text-neutral-700 mb-2 font-subheader">Alias/Last Name at Birth</label>
                    {{ form.alias }}
                    {% if form.alias.errors %}
                        <div class="mt-1 text-sm text-red-600">{{ form.alias.errors.0 }}</div>
                    {% endif %}
                </div>

                <!-- DOB -->
                <div>
                    <label for="{{ form.dob.id_for_label }}" class="block text-sm font-bold text-neutral-700 mb-2 font-subheader">DOB (Date of Birth) *</label>
                    {{ form.dob }}
                    {% if form.dob.errors %}
                        <div class="mt-1 text-sm text-red-600">{{ form.dob.errors.0 }}</div>
                    {% endif %}
                </div>

                <!-- Age -->
                <div>
                    <label for="{{ form.age.id_for_label }}" class="block text-sm font-bold text-neutral-700 mb-2 font-subheader">Age</label>
                    {{ form.age }}
                    {% if form.age.errors %}
                        <div class="mt-1 text-sm text-red-600">{{ form.age.errors.0 }}</div>
                    {% endif %}
                </div>

                <!-- Gender -->
                <div>
                    <label for="{{ form.gender.id_for_label }}" class="block text-sm font-bold text-neutral-700 mb-2 font-subheader">Gender *</label>
                    <select name="{{ form.gender.name }}" id="{{ form.gender.id_for_label }}" required class="form-control">
                        <option value="">Select Gender</option>
                        <option value="Male" {% if form.gender.value == 'Male' %}selected{% endif %}>Male</option>
                        <option value="Female" {% if form.gender.value == 'Female' %}selected{% endif %}>Female</option>
                        <option value="Non-binary" {% if form.gender.value == 'Non-binary' %}selected{% endif %}>Non-binary</option>
                        <option value="Other" {% if form.gender.value == 'Other' %}selected{% endif %}>Other</option>
                        <option value="Prefer not to say" {% if form.gender.value == 'Prefer not to say' %}selected{% endif %}>Prefer not to say</option>
                    </select>
                    {% if form.gender.errors %}
                        <div class="mt-1 text-sm text-red-600">{{ form.gender.errors.0 }}</div>
                    {% endif %}
                </div>

                <!-- Gender Identity -->
                <div>
                    <label for="{{ form.gender_identity.id_for_label }}" class="block text-sm font-bold text-neutral-700 mb-2 font-subheader">Gender Identity</label>
                    {{ form.gender_identity }}
                    {% if form.gender_identity.errors %}
                        <div class="mt-1 text-sm text-red-600">{{ form.gender_identity.errors.0 }}</div>
                    {% endif %}
                </div>

                <!-- Pronoun -->
                <div>
                    <label for="{{ form.pronoun.id_for_label }}" class="block text-sm font-bold text-neutral-700 mb-2 font-subheader">Pronoun</label>
                    {{ form.pronoun }}
                    {% if form.pronoun.errors %}
                        <div class="mt-1 text-sm text-red-600">{{ form.pronoun.errors.0 }}</div>
                    {% endif %}
                </div>

                <!-- Marital Status -->
                <div>
                    <label for="{{ form.marital_status.id_for_label }}" class="block text-sm font-bold text-neutral-700 mb-2 font-subheader">Marital Status</label>
                    {{ form.marital_status }}
                    {% if form.marital_status.errors %}
                        <div class="mt-1 text-sm text-red-600">{{ form.marital_status.errors.0 }}</div>
                    {% endif %}
                </div>

                <!-- Citizenship Status -->
                <div>
                    <label for="{{ form.citizenship_status.id_for_label }}" class="block text-sm font-bold text-neutral-700 mb-2 font-subheader">Citizenship Status</label>
                    {{ form.citizenship_status }}
                    {% if form.citizenship_status.errors %}
                        <div class="mt-1 text-sm text-red-600">{{ form.citizenship_status.errors.0 }}</div>
                    {% endif %}
                </div>

                <!-- Location/County -->
                <div>
                    <label for="{{ form.location_county.id_for_label }}" class="block text-sm font-bold text-neutral-700 mb-2 font-subheader">Location/County</label>
                    {{ form.location_county }}
                    {% if form.location_county.errors %}
                        <div class="mt-1 text-sm text-red-600">{{ form.location_county.errors.0 }}</div>
                    {% endif %}
                </div>

                <!-- Province -->
                <div>
                    <label for="{{ form.province.id_for_label }}" class="block text-sm font-bold text-neutral-700 mb-2 font-subheader">Province</label>
                    {{ form.province }}
                    {% if form.province.errors %}
                        <div class="mt-1 text-sm text-red-600">{{ form.province.errors.0 }}</div>
                    {% endif %}
                </div>

                <!-- City -->
                <div>
                    <label for="{{ form.city.id_for_label }}" class="block text-sm font-bold text-neutral-700 mb-2 font-subheader">City</label>
                    {{ form.city }}
                    {% if form.city.errors %}
                        <div class="mt-1 text-sm text-red-600">{{ form.city.errors.0 }}</div>
                    {% endif %}
                </div>

                <!-- Postal Code -->
                <div>
                    <label for="{{ form.postal_code.id_for_label }}" class="block text-sm font-bold text-neutral-700 mb-2 font-subheader">Postal Code</label>
                    {{ form.postal_code }}
                    {% if form.postal_code.errors %}
                        <div class="mt-1 text-sm text-red-600">{{ form.postal_code.errors.0 }}</div>
                    {% endif %}
                </div>

                <!-- Address -->
                <div class="md:col-span-2">
                    <label for="{{ form.address.id_for_label }}" class="block text-sm font-bold text-neutral-700 mb-2 font-subheader">Address</label>
                    {{ form.address }}
                    {% if form.address.errors %}
                        <div class="mt-1 text-sm text-red-600">{{ form.address.errors.0 }}</div>
                    {% endif %}
                </div>

                <!-- Address 2 -->
                <div>
                    <label for="{{ form.address_2.id_for_label }}" class="block text-sm font-bold text-neutral-700 mb-2 font-subheader">Address 2</label>
                    {{ form.address_2 }}
                    {% if form.address_2.errors %}
                        <div class="mt-1 text-sm text-red-600">{{ form.address_2.errors.0 }}</div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- üåç CULTURAL & DEMOGRAPHIC INFO -->
        <div class="bg-white rounded-xl shadow-sm border border-neutral-200 p-6">
            <div class="flex items-center mb-6">
                <div class="w-10 h-10 bg-gradient-to-br from-secondary-400 to-secondary-700 rounded-lg flex items-center justify-center shadow-sm mr-4">
                    <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                    </svg>
                </div>
                <h2 class="text-xl font-bold text-neutral-800 font-header">üåç Cultural & Demographic Info</h2>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Language -->
                <div>
                    <label for="{{ form.language.id_for_label }}" class="block text-sm font-bold text-neutral-700 mb-2 font-subheader">Language</label>
                    {{ form.language }}
                    {% if form.language.errors %}
                        <div class="mt-1 text-sm text-red-600">{{ form.language.errors.0 }}</div>
                    {% endif %}
                </div>

                <!-- Preferred Language -->
                <div>
                    <label for="{{ form.preferred_language.id_for_label }}" class="block text-sm font-bold text-neutral-700 mb-2 font-subheader">Preferred Language</label>
                    {{ form.preferred_language }}
                    {% if form.preferred_language.errors %}
                        <div class="mt-1 text-sm text-red-600">{{ form.preferred_language.errors.0 }}</div>
                    {% endif %}
                </div>

                <!-- Mother Tongue -->
                <div>
                    <label for="{{ form.mother_tongue.id_for_label }}" class="block text-sm font-bold text-neutral-700 mb-2 font-subheader">Mother Tongue</label>
                    {{ form.mother_tongue }}
                    {% if form.mother_tongue.errors %}
                        <div class="mt-1 text-sm text-red-600">{{ form.mother_tongue.errors.0 }}</div>
                    {% endif %}
                </div>

                <!-- Official Language -->
                <div>
                    <label for="{{ form.official_language.id_for_label }}" class="block text-sm font-bold text-neutral-700 mb-2 font-subheader">Official Language</label>
                    {{ form.official_language }}
                    {% if form.official_language.errors %}
                        <div class="mt-1 text-sm text-red-600">{{ form.official_language.errors.0 }}</div>
                    {% endif %}
                </div>

                <!-- Language Interpreter Required -->
                <div>
                    <label class="block text-sm font-bold text-neutral-700 mb-2 font-subheader">Language Interpreter Required</label>
                    <div class="flex items-center">
                        {{ form.language_interpreter_required }}
                        <label for="{{ form.language_interpreter_required.id_for_label }}" class="ml-2 text-sm text-neutral-700">Yes</label>
                    </div>
                    {% if form.language_interpreter_required.errors %}
                        <div class="mt-1 text-sm text-red-600">{{ form.language_interpreter_required.errors.0 }}</div>
                    {% endif %}
                </div>

                <!-- Self-Identification as Race/Ethnicity -->
                <div>
                    <label for="{{ form.self_identification_race_ethnicity.id_for_label }}" class="block text-sm font-bold text-neutral-700 mb-2 font-subheader">Self-Identification as Race/Ethnicity</label>
                    {{ form.self_identification_race_ethnicity }}
                    {% if form.self_identification_race_ethnicity.errors %}
                        <div class="mt-1 text-sm text-red-600">{{ form.self_identification_race_ethnicity.errors.0 }}</div>
                    {% endif %}
                </div>

                <!-- Aboriginal Status -->
                <div>
                    <label for="{{ form.aboriginal_status.id_for_label }}" class="block text-sm font-bold text-neutral-700 mb-2 font-subheader">Aboriginal Status</label>
                    {{ form.aboriginal_status }}
                    {% if form.aboriginal_status.errors %}
                        <div class="mt-1 text-sm text-red-600">{{ form.aboriginal_status.errors.0 }}</div>
                    {% endif %}
                </div>

                <!-- LGBTQ+ -->
                <div>
                    <label for="{{ form.lgbtq_status.id_for_label }}" class="block text-sm font-bold text-neutral-700 mb-2 font-subheader">LGBTQ+?</label>
                    {{ form.lgbtq_status }}
                    {% if form.lgbtq_status.errors %}
                        <div class="mt-1 text-sm text-red-600">{{ form.lgbtq_status.errors.0 }}</div>
                    {% endif %}
                </div>

                <!-- Highest Level of Education -->
                <div>
                    <label for="{{ form.highest_level_education.id_for_label }}" class="block text-sm font-bold text-neutral-700 mb-2 font-subheader">Highest Level of Education</label>
                    {{ form.highest_level_education }}
                    {% if form.highest_level_education.errors %}
                        <div class="mt-1 text-sm text-red-600">{{ form.highest_level_education.errors.0 }}</div>
                    {% endif %}
                </div>

                <!-- Children Home -->
                <div>
                    <label class="block text-sm font-bold text-neutral-700 mb-2 font-subheader">Children Home</label>
                    <div class="flex items-center">
                        {{ form.children_home }}
                        <label for="{{ form.children_home.id_for_label }}" class="ml-2 text-sm text-neutral-700">Yes</label>
                    </div>
                    {% if form.children_home.errors %}
                        <div class="mt-1 text-sm text-red-600">{{ form.children_home.errors.0 }}</div>
                    {% endif %}
                </div>

                <!-- Children Number -->
                <div>
                    <label for="{{ form.children_number.id_for_label }}" class="block text-sm font-bold text-neutral-700 mb-2 font-subheader">Children Number</label>
                    {{ form.children_number }}
                    {% if form.children_number.errors %}
                        <div class="mt-1 text-sm text-red-600">{{ form.children_number.errors.0 }}</div>
                    {% endif %}
                </div>

                <!-- LHIN -->
                <div>
                    <label for="{{ form.lhin.id_for_label }}" class="block text-sm font-bold text-neutral-700 mb-2 font-subheader">LHIN (Local Health Integration Network)</label>
                    {{ form.lhin }}
                    {% if form.lhin.errors %}
                        <div class="mt-1 text-sm text-red-600">{{ form.lhin.errors.0 }}</div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- üíä MEDICAL & HEALTH INFORMATION -->
        <div class="bg-white rounded-xl shadow-sm border border-neutral-200 p-6">
            <div class="flex items-center mb-6">
                <div class="w-10 h-10 bg-gradient-to-br from-red-400 to-red-600 rounded-lg flex items-center justify-center shadow-sm mr-4">
                    <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                    </svg>
                </div>
                <h2 class="text-xl font-bold text-neutral-800 font-header">üíä Medical & Health Information</h2>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Medical Conditions -->
                <div>
                    <label for="{{ form.medical_conditions.id_for_label }}" class="block text-sm font-bold text-neutral-700 mb-2 font-subheader">Medical Conditions</label>
                    {{ form.medical_conditions }}
                    {% if form.medical_conditions.errors %}
                        <div class="mt-1 text-sm text-red-600">{{ form.medical_conditions.errors.0 }}</div>
                    {% endif %}
                </div>

                <!-- Primary Diagnosis -->
                <div>
                    <label for="{{ form.primary_diagnosis.id_for_label }}" class="block text-sm font-bold text-neutral-700 mb-2 font-subheader">Primary Diagnosis</label>
                    {{ form.primary_diagnosis }}
                    {% if form.primary_diagnosis.errors %}
                        <div class="mt-1 text-sm text-red-600">{{ form.primary_diagnosis.errors.0 }}</div>
                    {% endif %}
                </div>

                <!-- Family Doctor -->
                <div>
                    <label for="{{ form.family_doctor.id_for_label }}" class="block text-sm font-bold text-neutral-700 mb-2 font-subheader">Family Doctor</label>
                    {{ form.family_doctor }}
                    {% if form.family_doctor.errors %}
                        <div class="mt-1 text-sm text-red-600">{{ form.family_doctor.errors.0 }}</div>
                    {% endif %}
                </div>

                <!-- Health Card Number -->
                <div>
                    <label for="{{ form.health_card_number.id_for_label }}" class="block text-sm font-bold text-neutral-700 mb-2 font-subheader">HC# (Health Card Number)</label>
                    {{ form.health_card_number }}
                    {% if form.health_card_number.errors %}
                        <div class="mt-1 text-sm text-red-600">{{ form.health_card_number.errors.0 }}</div>
                    {% endif %}
                </div>

                <!-- Health Card Version -->
                <div>
                    <label for="{{ form.health_card_version.id_for_label }}" class="block text-sm font-bold text-neutral-700 mb-2 font-subheader">HC Version</label>
                    {{ form.health_card_version }}
                    {% if form.health_card_version.errors %}
                        <div class="mt-1 text-sm text-red-600">{{ form.health_card_version.errors.0 }}</div>
                    {% endif %}
                </div>

                <!-- Health Card Exp Date -->
                <div>
                    <label for="{{ form.health_card_exp_date.id_for_label }}" class="block text-sm font-bold text-neutral-700 mb-2 font-subheader">HC Exp Date</label>
                    {{ form.health_card_exp_date }}
                    {% if form.health_card_exp_date.errors %}
                        <div class="mt-1 text-sm text-red-600">{{ form.health_card_exp_date.errors.0 }}</div>
                    {% endif %}
                </div>

                <!-- Health Card Issuing Province -->
                <div>
                    <label for="{{ form.health_card_issuing_province.id_for_label }}" class="block text-sm font-bold text-neutral-700 mb-2 font-subheader">HC Issuing Province</label>
                    {{ form.health_card_issuing_province }}
                    {% if form.health_card_issuing_province.errors %}
                        <div class="mt-1 text-sm text-red-600">{{ form.health_card_issuing_province.errors.0 }}</div>
                    {% endif %}
                </div>

                <!-- No HC Reason -->
                <div>
                    <label for="{{ form.no_health_card_reason.id_for_label }}" class="block text-sm font-bold text-neutral-700 mb-2 font-subheader">No HC Reason</label>
                    {{ form.no_health_card_reason }}
                    {% if form.no_health_card_reason.errors %}
                        <div class="mt-1 text-sm text-red-600">{{ form.no_health_card_reason.errors.0 }}</div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- üë• CONTACT & PERMISSIONS -->
        <div class="bg-white rounded-xl shadow-sm border border-neutral-200 p-6">
            <div class="flex items-center mb-6">
                <div class="w-10 h-10 bg-gradient-to-br from-accent-400 to-accent-600 rounded-lg flex items-center justify-center shadow-sm mr-4">
                    <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
                    </svg>
                </div>
                <h2 class="text-xl font-bold text-neutral-800 font-header">üë• Contact & Permissions</h2>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Permission to Phone -->
                <div>
                    <label class="block text-sm font-bold text-neutral-700 mb-2 font-subheader">Permission to Phone</label>
                    <div class="flex items-center">
                        {{ form.permission_to_phone }}
                        <label for="{{ form.permission_to_phone.id_for_label }}" class="ml-2 text-sm text-neutral-700">Yes</label>
                    </div>
                    {% if form.permission_to_phone.errors %}
                        <div class="mt-1 text-sm text-red-600">{{ form.permission_to_phone.errors.0 }}</div>
                    {% endif %}
                </div>

                <!-- Permission to Email -->
                <div>
                    <label class="block text-sm font-bold text-neutral-700 mb-2 font-subheader">Permission to Email</label>
                    <div class="flex items-center">
                        {{ form.permission_to_email }}
                        <label for="{{ form.permission_to_email.id_for_label }}" class="ml-2 text-sm text-neutral-700">Yes</label>
                    </div>
                    {% if form.permission_to_email.errors %}
                        <div class="mt-1 text-sm text-red-600">{{ form.permission_to_email.errors.0 }}</div>
                    {% endif %}
                </div>

                <!-- Phone -->
                <div>
                    <label for="{{ form.phone.id_for_label }}" class="block text-sm font-bold text-neutral-700 mb-2 font-subheader">Phone</label>
                    {{ form.phone }}
                    {% if form.phone.errors %}
                        <div class="mt-1 text-sm text-red-600">{{ form.phone.errors.0 }}</div>
                    {% endif %}
                </div>

                <!-- Phone Work -->
                <div>
                    <label for="{{ form.phone_work.id_for_label }}" class="block text-sm font-bold text-neutral-700 mb-2 font-subheader">Phone (Work)</label>
                    {{ form.phone_work }}
                    {% if form.phone_work.errors %}
                        <div class="mt-1 text-sm text-red-600">{{ form.phone_work.errors.0 }}</div>
                    {% endif %}
                </div>

                <!-- Phone Alt -->
                <div>
                    <label for="{{ form.phone_alt.id_for_label }}" class="block text-sm font-bold text-neutral-700 mb-2 font-subheader">Phone (Alt)</label>
                    {{ form.phone_alt }}
                    {% if form.phone_alt.errors %}
                        <div class="mt-1 text-sm text-red-600">{{ form.phone_alt.errors.0 }}</div>
                    {% endif %}
                </div>

                <!-- Email -->
                <div>
                    <label for="{{ form.email.id_for_label }}" class="block text-sm font-bold text-neutral-700 mb-2 font-subheader">Email</label>
                    {{ form.email }}
                    {% if form.email.errors %}
                        <div class="mt-1 text-sm text-red-600">{{ form.email.errors.0 }}</div>
                    {% endif %}
                </div>

                <!-- Comments -->
                <div class="md:col-span-2">
                    <label for="{{ form.comments.id_for_label }}" class="block text-sm font-bold text-neutral-700 mb-2 font-subheader">Comments</label>
                    {{ form.comments }}
                    {% if form.comments.errors %}
                        <div class="mt-1 text-sm text-red-600">{{ form.comments.errors.0 }}</div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- üßë‚Äçüíº PROGRAM / ENROLLMENT DETAILS -->
        <div class="bg-white rounded-xl shadow-sm border border-neutral-200 p-6">
            <div class="flex items-center mb-6">
                <div class="w-10 h-10 bg-gradient-to-br from-green-400 to-green-600 rounded-lg flex items-center justify-center shadow-sm mr-4">
                    <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                    </svg>
                </div>
                <h2 class="text-xl font-bold text-neutral-800 font-header">üßë‚Äçüíº Program / Enrollment Details</h2>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Program -->
                <div>
                    <label for="{{ form.program.id_for_label }}" class="block text-sm font-bold text-neutral-700 mb-2 font-subheader">Program</label>
                    {{ form.program }}
                    {% if form.program.errors %}
                        <div class="mt-1 text-sm text-red-600">{{ form.program.errors.0 }}</div>
                    {% endif %}
                </div>

                <!-- Sub-program -->
                <div>
                    <label for="{{ form.sub_program.id_for_label }}" class="block text-sm font-bold text-neutral-700 mb-2 font-subheader">Sub-program</label>
                    {{ form.sub_program }}
                    {% if form.sub_program.errors %}
                        <div class="mt-1 text-sm text-red-600">{{ form.sub_program.errors.0 }}</div>
                    {% endif %}
                </div>

                <!-- Level of Support -->
                <div>
                    <label for="{{ form.level_of_support.id_for_label }}" class="block text-sm font-bold text-neutral-700 mb-2 font-subheader">Level of Support</label>
                    {{ form.level_of_support }}
                    {% if form.level_of_support.errors %}
                        <div class="mt-1 text-sm text-red-600">{{ form.level_of_support.errors.0 }}</div>
                    {% endif %}
                </div>

                <!-- Client Type -->
                <div>
                    <label for="{{ form.client_type.id_for_label }}" class="block text-sm font-bold text-neutral-700 mb-2 font-subheader">Client Type</label>
                    {{ form.client_type }}
                    {% if form.client_type.errors %}
                        <div class="mt-1 text-sm text-red-600">{{ form.client_type.errors.0 }}</div>
                    {% endif %}
                </div>

                <!-- Admission Date -->
                <div>
                    <label for="{{ form.admission_date.id_for_label }}" class="block text-sm font-bold text-neutral-700 mb-2 font-subheader">Admission Date</label>
                    {{ form.admission_date }}
                    {% if form.admission_date.errors %}
                        <div class="mt-1 text-sm text-red-600">{{ form.admission_date.errors.0 }}</div>
                    {% endif %}
                </div>

                <!-- Discharge Date -->
                <div>
                    <label for="{{ form.discharge_date.id_for_label }}" class="block text-sm font-bold text-neutral-700 mb-2 font-subheader">Discharge Date</label>
                    {{ form.discharge_date }}
                    {% if form.discharge_date.errors %}
                        <div class="mt-1 text-sm text-red-600">{{ form.discharge_date.errors.0 }}</div>
                    {% endif %}
                </div>

                <!-- Days Elapsed -->
                <div>
                    <label for="{{ form.days_elapsed.id_for_label }}" class="block text-sm font-bold text-neutral-700 mb-2 font-subheader">Days Elapsed</label>
                    {{ form.days_elapsed }}
                    {% if form.days_elapsed.errors %}
                        <div class="mt-1 text-sm text-red-600">{{ form.days_elapsed.errors.0 }}</div>
                    {% endif %}
                </div>

                <!-- Program Status -->
                <div>
                    <label for="{{ form.program_status.id_for_label }}" class="block text-sm font-bold text-neutral-700 mb-2 font-subheader">Program Status</label>
                    {{ form.program_status }}
                    {% if form.program_status.errors %}
                        <div class="mt-1 text-sm text-red-600">{{ form.program_status.errors.0 }}</div>
                    {% endif %}
                </div>

                <!-- Receiving Services -->
                <div>
                    <label class="block text-sm font-bold text-neutral-700 mb-2 font-subheader">Receiving Services</label>
                    <div class="flex items-center">
                        {{ form.receiving_services }}
                        <label for="{{ form.receiving_services.id_for_label }}" class="ml-2 text-sm text-neutral-700">Yes</label>
                    </div>
                    {% if form.receiving_services.errors %}
                        <div class="mt-1 text-sm text-red-600">{{ form.receiving_services.errors.0 }}</div>
                    {% endif %}
                </div>

                <!-- Referral Source -->
                <div>
                    <label for="{{ form.referral_source.id_for_label }}" class="block text-sm font-bold text-neutral-700 mb-2 font-subheader">Referral Source</label>
                    {{ form.referral_source }}
                    {% if form.referral_source.errors %}
                        <div class="mt-1 text-sm text-red-600">{{ form.referral_source.errors.0 }}</div>
                    {% endif %}
                </div>

                <!-- Reason for Discharge -->
                <div class="md:col-span-2">
                    <label for="{{ form.reason_discharge.id_for_label }}" class="block text-sm font-bold text-neutral-700 mb-2 font-subheader">Reason (for Discharge/Program Status)</label>
                    {{ form.reason_discharge }}
                    {% if form.reason_discharge.errors %}
                        <div class="mt-1 text-sm text-red-600">{{ form.reason_discharge.errors.0 }}</div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- üßæ ADMINISTRATIVE / SYSTEM FIELDS -->
        <div class="bg-white rounded-xl shadow-sm border border-neutral-200 p-6">
            <div class="flex items-center mb-6">
                <div class="w-10 h-10 bg-gradient-to-br from-neutral-500 to-neutral-700 rounded-lg flex items-center justify-center shadow-sm mr-4">
                    <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>
                </div>
                <h2 class="text-xl font-bold text-neutral-800 font-header">üßæ Administrative / System Fields</h2>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Chart Number -->
                <div>
                    <label for="{{ form.chart_number.id_for_label }}" class="block text-sm font-bold text-neutral-700 mb-2 font-subheader">Chart Number</label>
                    {{ form.chart_number }}
                    {% if form.chart_number.errors %}
                        <div class="mt-1 text-sm text-red-600">{{ form.chart_number.errors.0 }}</div>
                    {% endif %}
                </div>

                <!-- Profile Picture -->
                <div>
                    <label for="{{ form.profile_picture.id_for_label }}" class="block text-sm font-bold text-neutral-700 mb-2 font-subheader">Profile Picture</label>
                    {{ form.profile_picture }}
                    {% if form.profile_picture.errors %}
                        <div class="mt-1 text-sm text-red-600">{{ form.profile_picture.errors.0 }}</div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Form Actions -->
        <div class="flex justify-end space-x-4 pt-6">
            <a href="{% url 'clients:list' %}" class="px-6 py-3 border border-neutral-300 text-sm font-bold rounded-xl text-neutral-700 bg-white hover:bg-neutral-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-sky transition-all duration-200 shadow-sm">
                Cancel
            </a>
            <button type="submit" class="px-6 py-3 border border-transparent text-sm font-bold rounded-xl text-white bg-brand-sky hover:bg-brand-darkBlue focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-sky transition-all duration-200 shadow-sm">
                {% if object %}Update Client{% else %}Create Client{% endif %}
            </button>
        </div>
    </form>
</div>

<script>
    function clientForm() {
        return {
            // Initialize any JavaScript functionality needed
            init() {
                // Auto-calculate age when DOB changes
                const dobField = document.getElementById('{{ form.dob.id_for_label }}');
                const ageField = document.getElementById('{{ form.age.id_for_label }}');
                
                if (dobField && ageField) {
                    dobField.addEventListener('change', function() {
                        if (this.value) {
                            const today = new Date();
                            const birthDate = new Date(this.value);
                            let age = today.getFullYear() - birthDate.getFullYear();
                            const monthDiff = today.getMonth() - birthDate.getMonth();
                            
                            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                                age--;
                            }
                            
                            ageField.value = age;
                        }
                    });
                }
            }
        }
    }
</script>

<style>
    /* Custom form field styling */
    .form-control {
        @apply w-full px-3 py-2 border border-neutral-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-sky focus:border-transparent font-body;
    }
    
    .form-control:focus {
        @apply ring-2 ring-brand-sky border-transparent;
    }
    
    /* Error state styling */
    .form-control:invalid {
        @apply border-red-300 focus:ring-red-500;
    }
    
    /* Checkbox styling */
    .form-check-input {
        @apply h-4 w-4 text-brand-sky focus:ring-brand-sky border-neutral-300 rounded;
    }
</style>
{% endblock %}
